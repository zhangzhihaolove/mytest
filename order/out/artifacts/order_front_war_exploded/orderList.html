<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="/js/layui-master/dist/css/layui.css" media="all">
    <link rel="stylesheet"
          href="/js/bootstrap3/css/bootstrap.min.css">
    <link href="/js/DataTables/DataTables-1.10.18/css/jquery.dataTables.css"rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/js/bootstrap/datetimepicker/bootstrap-datetimepicker.css">

    <script type="text/javascript"src="/js/DataTables/DataTables-1.10.18/js/jquery.dataTables.js"></script>
    <script type="text/javascript"src="/js/bootstrap3/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/layui-master/dist/layui.js"></script>
    <script src="/js/bootstrap/datetimepicker/bootstrap-datetimepicker.js"></script>
    <link  href="/js/bootstrap3/css/bootstrap.css" rel="stylesheet">
    <link  href="/js/bootstrap3/css/bootstrap-theme.css" rel="stylesheet">
    <link  href="/js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <link rel="stylesheet" href="/js/DataTables/DataTables-1.10.18/css/dataTables.bootstrap.css">
    <link  href="/js/fileinput5/css/fileinput.css" rel="stylesheet">
    <link href="/js/bootstrap-validator/css/bootstrapValidator.min.css" rel="stylesheet">

    <script src="/js/bootstrap3/js/bootstrap.js"></script>
    <script src="/js/DataTables/DataTables-1.10.18/js/jquery.dataTables.js"></script>
    <script src="/js/DataTables/DataTables-1.10.18/js/dataTables.bootstrap.js"></script>
    <script src="/js/bootstrap-datetimepicker/js/moment-with-locales.js"></script>
    <script src="/js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/bootbox/bootbox.min.js"></script>
    <script src="/js/fileinput5/js/fileinput.js"></script>
    <script src="/js/fileinput5/js/locales/zh.js"></script>
    <script src="/js/bootstrap-validator/js/bootstrapValidator.js"></script>
    <script src="/js/bootstrap-validator/js/bootstrapValidator.min.js"></script>
</head>
<style>
    .show-grid [class ^="col-"] {
        padding-top: 10px;
        padding-bottom: 10px;
        background-color: #;
        border: 1px solid #ddd;
        background-color: rgba(86, 61, 124, .15);
        border: 1px solid rgba(86, 61, 124, .2);
    }
</style>
<body>
<!--添加-->
<script type="text/html" id="addGoods"  >
    <div>
        <form class="form-horizontal" id="addFrom">

        <div class="form-group">
            <label  class="col-sm-2 control-label">商品选择</label>
            <div class="col-sm-4">
                <select class="form-control" id="add_beand"></select>
            </div>
        </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">商品价格</label>
                <div class="col-sm-4">
                    <input type="text"  id="productPrice" name="time" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">购买数量</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="add_subTotalCount"  placeholder="购买数量">
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">小计</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="add_price" name="price" placeholder="小计">
                </div>
            </div>
        <div class="form-group">
            <div style="margin-bottom: 100px"></div>
        </div>
        </form>

    </div>
</script>
<!--修改-->
<script type="text/html" id="updateGoods">
    <div>
        <form class="form-horizontal" id="updateFrom">
        <div class="form-group">
            <label  class="col-sm-2 control-label">商品选择</label>
            <div class="col-sm-4">
                <select class="form-control" id="update_beand"></select>
            </div>
        </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">商品价格</label>
                <div class="col-sm-4">
                    <input type="text"  id="update_productPrice" name="time" class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label  class="col-sm-2 control-label">购买数量</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="update_subTotalCount"  placeholder="购买数量">
                </div>
            </div>
            <div class="form-group">
                <label  class="col-sm-2 control-label">小计</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="update_price" name="price" placeholder="小计">
                </div>
            </div>

        <div class="form-group">
            <div style="margin-bottom: 100px"></div>
        </div>
        </form>
    </div>
</script>

<!-- 条件查询 -->

<!-- 查询条件面板 -->
<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">
            查询条件
        </h3>
    </div>
    <div class="panel-body">
        <form class="form-horizontal" drug="form">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">商品名:</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="productname" placeholder="请输⼊商品名">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">商品价格</label>
                            <div class="col-sm-10">
                                <div class="input-group">
                                    <input type="text" id="minPrice" class="form-control">
                                    <span class="input-group-addon">--</span>
                                    <input type="text" id="maxPrice" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12" style="text-align:center">
                        <button type="button" class="btn btn-primary" onclick="queryList()">
                            <span class="glyphicon glyphicon-search"></span>&nbsp;查询
                        </button>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        <button type="reset" class="btn btn-danger">
                            <span class="glyphicon glyphicon-refresh"></span>&nbsp;重置
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="form-group">
    <div class="col-sm-offset-5 col-sm-7">
        <button type="button" onclick="toAdd()" class="btn btn-success"><li class="glyphicon glyphicon-plus"></li></button>
        <button type="button" onclick="deleteBath()" class="btn btn-danger"><li class="glyphicon glyphicon-trash"></li>&nbsp;批量删除</button>
    </div>
</div>
<div class="panel panel-primary">
    <div class="panel-body">
        <div class="bs-example" data-example-id="striped-table">
            <table id="example" class="table table-striped table-bordered" style="width:100%">
                <thead>
                <tr>
                    <th>
                        <input type="checkbox" onclick="xuanAll()"/>全选
                    </th>
                    <th>订单编号</th>
                    <th>商品名称</th>
                    <th>商品价格</th>
                    <th>购买数量</th>
                    <th>小计金额</th>
                    <th>操作</th>
                </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
</body>
<script>
    var imgUrl = "http://192.168.1.111:8080/";
    var table;
    var idsList=[];
    $(function(){
        getPageData();
        queryBrandList();
        initDate();
        initFileAddInput();
        initFileUpdateInput();

    });
    /* 条件查询日期 */
    /*function initDate() {
        var minDate = $('#minDate').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        });
        var maxDate = $('#maxDate').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        });
        $('#createTime').datetimepicker({
            format: 'YYYY-MM-DD',
            locale: moment.locale('zh-cn')
        });
        //动态设置最小值
        minDate.on('dp.change', function (e) {
            maxDate.data('DateTimePicker').minDate(e.date);
        });
        //动态设置最大值
        maxDate.on('dp.change', function (e) {
            minDate.data('DateTimePicker').maxDate(e.date);
        });

    }*/
    /* 刷新页面 */
    function queryList(){
        $("#example").dataTable().fnDraw(false); //点击事件触发table重新请求服务器
    }
    //分页查询
    function getPageData(){
        var buttons="";
        table=$('#example').DataTable({
            "processing": true,
            "serverSide": true,//开启服务的模式
            "searching":false,
            "ordering":true,
            "order":[[0,'asc'],[1,'desc']],
            "aLengthMenu": [3, 5, 20], //更改显示记录数选项
            "ajax": {
                "url": "http://localhost:8080/order/queryMapGoodsList.do",
                "type": "POST",
                "data": function ( d ) {
                    //添加额外的参数传给服务器
                   /*d.name = $("#inputName").val();
                    d.minPrice = $("#minDate").val();
                    d.maxPrice = $("#maxDate").val();*/
                    /* d.typeId = $("#selectType").val();
                     d.startId = $("[name='status']:checked").val();*/
                },
                dataSrc: function (result) {
                    if (result.status==200) {
                        result.draw = result.data.draw;
                        result.recordsTotal = result.data.recordsTotal;
                        result.recordsFiltered = result.data.recordsFiltered;
                        return result.data.data;
                    }else{
                        return "";
                    }

                }
            },
            "columns": [
                {"data": "id", render:function(data){
                        return '<input type="checkbox" value="'+data+'" name="ids"/>'
                    }},
                {"data": "id"},
                {"data": "typeName"},
                {"data": "typePrice"},
                {"data": "count"},
                {"data": "subTotal"},
                /*{"data": "country",
                    render:function(data){
                        return data==1?"国语影片":"外语影片";
                    }
                },
                {"data": "areaName",
                    render:function(data){
                        return data.replace("1","郑州").replace("2","洛阳").replace("3","商丘");
                    }
                },
                {"data": "realPath",render: function(data) {
                        buttons = '<img src="'+imgUrl+''+data+'" width="50px"/>';
                        return buttons;
                    }},*/
                {"data" : "id",render:function(data, type, row, meta) {
                        /*if(row.count>0){
                            var buttonName = "购买";
                            var buttonColor = "btn btn-warning";
                            var buttonImg = "glyphicon glyphicon-arrow-down";
                            var status = 2;
                        }else{
                            var buttonName = "已售完";
                            var buttonColor = "btn btn-success";
                            var disabled="disabled";
                            var buttonImg = "glyphicon glyphicon-arrow-up";
                            var status = 1;
                        }*/
                        buttons = '<button type="button" class="btn btn-primary" onclick="toUpdate('+data+')"><li class="glyphicon glyphicon-pencil" ></li>&nbsp;修改</button>'+
                            '<button type="button" class="btn btn-danger " onclick="deleteGoods('+data+')"><li class="glyphicon glyphicon-remove-sign" ></li>&nbsp;删除</button>';
                            /*'<button type="button" class="'+buttonColor +'"'+ disabled +' onclick="updateStatusDown('+data+','+status+')"><li class="'+buttonImg+'" ></li>&nbsp;'+buttonName+'</button>'*/
                        return buttons;
                    }}

            ],
            "drawCallback": function( settings ) {
                console.log(idsList);
                if(idsList.length>0){
                    $("[name='ids']").each(function () {
                        if(idsList.indexOf(this.value)!=-1){
                            this.checked=true;
                            $(this).parent().parent().css("background-color","pink");
                        }
                    })
                }
            },
            "language": {                              // 这是修改语言的显示
                buttons: {
                    pageLength: {
                        _: "显示%d条",
                        '-1': "全部显示"
                    }
                },
                paginate: {
                    first: "首条",
                    previous: "前一页",
                    next: "下一页",
                    last: "末页"
                },
                "info": "第_PAGE_页,共_PAGES_页",
                "infoEmpty": "未找到相关数据",
                "search": "关键字",
                "zeroRecords": "未找到相关数据",
                "decimal": ".",
                "thousands": ","
            }
        })
    }
    /* 条件查询下拉框 */
    function queryBrandList(){
        $.post(
            "http://localhost:8080/order/queryTypeList.do",
            function(result){
                if(result.status==200){
                    var data=result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for ( var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#selectType").html(str);

                }
            }
        )

    }
    /* 添加 */
    function toAdd(){
        bootbox.dialog({
            title: "添加商品",
            message: $("#addGoods").html(),
            buttons: {
                Cancel: {
                    label: "撤销",
                    className: "btn-default",
                    callback: function () {
                        alert("操作失败");
                    }
                }
                , OK: {
                    label: "提交",
                    className: "btn-primary",
                    callback: function () {
                        var order = {};
                        order.subTotal = $("#add_price").val();
                        order.productId = $("#add_beand").val();
                        order.count = $("#add_subTotalCount").val();
                        $.post(
                            "http://localhost:8080/order/addOrder.do",
                            order,
                            function (result) {
                                if(result.status==200){
                                    alert("操作完成");
                                    queryList();
                                } else {
                                    bootbox.alert(
                                        "系统异常，请联系管理员",function() {

                                        }
                                    )
                                }
                            }
                        )
                    }
                }
            }
        });
        queryAddBrandList();
    }
    /*添加下拉*/
    function queryAddBrandList(){
        $.post(
            "http://localhost:8080/order/queryTypeList.do",
            function(result) {
                if (result.status == 200) {
                    var data = result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for (var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#add_beand").html(str);
                }
            })
    }
    function showPrice(productId){
        productId = $("#add_beand").val();
        $.post(
            "http://localhost:8080/order/queryTypeList.do",
            function(result) {
                if (result.status == 200) {
                    var data = result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for (var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#add_beand").html(str);
                }
            })
    }
    /* 修改 */
    function toUpdate(id){
        window.event.stopPropagation();// 阻止冒泡
        bootbox.dialog({
            title: "修改商品",
            message: $("#updateGoods").html(),
            buttons: {
                Cancel: {
                    label: "撤销",
                    className: "btn-default",
                    callback: function () {
                        alert("操作失败");
                    }
                }
                , OK: {
                    label: "提交",
                    className: "btn-primary",
                    callback: function () {
                        var order = {};
                        order.id = id;
                        order.subTotal = $("#update_price").val();
                        order.count = $("#update_subTotalCount").val();
                        order.productId = $("#update_beand").val();
                        $.post(
                            "http://localhost:8080/order/updateOrder.do",
                            order,
                            function (result) {
                                if(result.status==200){
                                    alert("操作完成");
                                    queryList();
                                } else {
                                    bootbox.alert(
                                        "系统异常，请联系管理员",function() {

                                        }
                                    )
                                }
                            }
                        )
                    }
                }
            }
        });
        queryUpdateBrandList();
        queryList();
        $.post(
            "http://localhost:8080/order/getOrderById.do",
            {"id":id},
            function(result){
                if(result.status==200) {
                    var data = result.data;
                    $("#update_price").val(data.subTotal);
                    $("#update_subTotalCount").val(data.count);
                    $("#update_beand").val(data.productId);
                    $("#update_productPrice").val(data.typePrice);
                  /*  for (var j = 0; j < aaa.length; j++) {
                        for (var i = 0; i < b.length; i++) {
                            if (b[i] == j[i]) {
                                b[i].checked = true;
                            }
                        }
                    }*/

                    initFileUpdateInput();
                    updateInitDate();
                }
            }
        );

    }
    /*修改下拉*/
    function queryUpdateBrandList(){
        $.post(
            "http://localhost:8080/order/queryTypeList.do",
            function(result) {
                if (result.status == 200) {
                    var data = result.data;
                    var str = "<option value='0'>==请选择==</option>";
                    for (var i = 0; i < data.length; i++) {
                        str += "<option value=" + data[i].id + ">" + data[i].name + "</option>";
                    }
                    $("#update_beand").html(str);
                }
            })
    }
    /* 删除 */
    function deleteGoods(id){
        window.event.stopPropagation();// 阻止冒泡
        bootbox.dialog({
            message: "你确定要删除吗",
            title: "危险操作",
            buttons: {
                Cancel: {
                    label: "容我想想",
                    className: "btn-default",
                    callback: function () {
                        alert("操作终止");
                    }
                }
                , OK: {
                    label: "确认删除",
                    className: "btn-primary",
                    callback: function () {
                        $.post(
                            "http://localhost:8080/order/deleteOrder.do",
                            {"id":id},
                            function (result) {
                                if(result.status==200){
                                    alert("操作完成");
                                    queryList();

                                } else {
                                    bootbox.alert(
                                        "系统异常，请联系管理员",function() {

                                        }
                                    )
                                }
                            }
                        )



                    }
                }
            }
        });
    }
    /* 购票 */
    function updateStatusDown(id,status) {
        $.post(
              "http://localhost:8080/order/updateStatusDown.do",
               {"id":id},
               function (result) {
                  if(result.status==200){
                      alert("操作完成");
                       queryList();
                          } else {
                               bootbox.alert(
                                    "系统异常，请联系管理员",function() {

                               }
                             )
                           }
                       }
                   )
    }
    /* 反选 */
    function xuanAll(){
        window.event.stopPropagation();// 阻止冒泡
        $("[name='ids']").each(function(){
            if(!this.checked){
                $(this).parent().parent().css("background-color","pink");
                idsList.push(this.value)
            }else{
                $(this).parent().parent().css("background-color","");
                idsList.splice(idsList.indexOf(this.value),1)
            }
            this.checked=!this.checked;
        })
    }
    /* 批量删除 */
    function deleteBath(){
        window.event.stopPropagation();// 阻止冒泡
        if(idsList.length>0){
            $.post(
                "http://localhost:8080/order/deleteBatch.do",
                {"idsList":idsList},
                function (result) {
                    if(result.status==200){
                        queryList();
                    }else{
                        bootbox.confirm("操作失败,请联系管理员!",function () {

                        })
                    }
                }
            )
        }else{
            bootbox.alert("请选择要删除的数据！",function(){

            })
        }
    }

</script>
</html>